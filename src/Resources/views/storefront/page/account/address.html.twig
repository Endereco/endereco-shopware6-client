{% sw_extends '@Storefront/storefront/page/account/address.html.twig' %}

{% block page_account_overview_addresses %}
    {{ parent() }}

    <script>
        ( function() {
            var $billigAMSSet = false;
            var $waitForBillingFormEdit = setInterval( function() {
                if (
                    document.querySelector('[name="changeableAddresses[changeBilling]"]') &&
                    '1' === document.querySelector('[name="changeableAddresses[changeBilling]"]').value
                ) {
                    if (!$billigAMSSet) {
                        enderecoInitAMS({
                            countryCode: '#address-create-edit #addressAddressCountry',
                            postalCode: '#address-create-edit #addressAddressZipcode',
                            locality: '#address-create-edit #addressAddressCity',
                            streetFull: '#address-create-edit #addressAddressStreet',
                            streetName: '',
                            buildingNumber: '',
                            additionalInfo: ''
                        }, {
                            name: 'billing_edit',
                            addressType: 'billing_address',
                            ajaxForm: true
                        }, function(EAO) {
                            document.querySelector('#address-create-edit #addressAddressCountry').closest('form').querySelector('[type="submit"]').addEventListener('click', function(e) {

                                if (EAO.util.shouldBeChecked()) {
                                    e.preventDefault();

                                    // Resume click after ac is done.
                                    window.EnderecoIntegrator.submitResume = function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    }

                                    EAO.util.checkAddress().then().catch(function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    });
                                    return false;
                                }
                            })
                        });
                        $billigAMSSet = true;
                    }
                } else {
                    $billigAMSSet = false;
                }
            }, 100);
            var $billigAMSNewSet = false;
            var $waitForBillingFormNew = setInterval( function() {
                if (
                    document.querySelector('[name="changeableAddresses[changeBilling]"]') &&
                    '1' === document.querySelector('[name="changeableAddresses[changeBilling]"]').value
                ) {
                    if (!$billigAMSNewSet) {
                        enderecoInitAMS({
                            countryCode: '#address-create-new #addressAddressCountry',
                            postalCode: '#address-create-new #addressAddressZipcode',
                            locality: '#address-create-new #addressAddressCity',
                            streetFull: '#address-create-new #addressAddressStreet',
                            streetName: '',
                            buildingNumber: '',
                            additionalInfo: ''
                        }, {
                            name: 'billing_new',
                            addressType: 'billing_address',
                            ajaxForm: true
                        }, function(EAO) {
                            document.querySelector('#address-create-new #addressAddressCountry').closest('form').querySelector('[type="submit"]').addEventListener('click', function(e) {

                                if (EAO.util.shouldBeChecked()) {
                                    e.preventDefault();

                                    // Resume click after ac is done.
                                    window.EnderecoIntegrator.submitResume = function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    }

                                    EAO.util.checkAddress().then().catch(function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    });
                                    return false;
                                }
                            })
                        });

                        $billigAMSNewSet = true;
                    }
                } else {
                    $billigAMSNewSet = false;
                }
            }, 100)
        })();
    </script>

    <script>
        ( function() {
            var $shippingAMSSet = false;
            var $waitForShippingFormEdit = setInterval( function() {
                if (
                    document.querySelector('[name="changeableAddresses[changeShipping]"]') &&
                    '1' === document.querySelector('[name="changeableAddresses[changeShipping]"]').value
                ) {
                    if (!$shippingAMSSet) {
                        enderecoInitAMS({
                            countryCode: '#address-create-edit #addressAddressCountry',
                            postalCode: '#address-create-edit #addressAddressZipcode',
                            locality: '#address-create-edit #addressAddressCity',
                            streetFull: '#address-create-edit #addressAddressStreet',
                            streetName: '',
                            buildingNumber: '',
                            additionalInfo: ''
                        }, {
                            name: 'shipping_edit',
                            addressType: 'shipping_address',
                            ajaxForm: true
                        }, function(EAO) {
                            document.querySelector('#address-create-edit #addressAddressCountry').closest('form').querySelector('[type="submit"]').addEventListener('click', function(e) {

                                if (EAO.util.shouldBeChecked()) {
                                    e.preventDefault();

                                    // Resume click after ac is done.
                                    window.EnderecoIntegrator.submitResume = function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    }

                                    EAO.util.checkAddress().then().catch(function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    });
                                    return false;
                                }
                            })
                        });

                        $shippingAMSSet = true;
                    }
                } else {
                    $shippingAMSSet = false;
                }
            }, 100);
            var $shippingAMSNewSet = false;
            var $waitForShippingFormNew = setInterval( function() {
                if (
                    document.querySelector('[name="changeableAddresses[changeShipping]"]') &&
                    '1' === document.querySelector('[name="changeableAddresses[changeShipping]"]').value
                ) {
                    if (!$shippingAMSNewSet) {
                        enderecoInitAMS({
                            countryCode: '#address-create-new #addressAddressCountry',
                            postalCode: '#address-create-new #addressAddressZipcode',
                            locality: '#address-create-new #addressAddressCity',
                            streetFull: '#address-create-new #addressAddressStreet',
                            streetName: '',
                            buildingNumber: '',
                            additionalInfo: ''
                        }, {
                            name: 'shipping_new',
                            addressType: 'shipping_address',
                            ajaxForm: true
                        }, function(EAO) {
                            document.querySelector('#address-create-new #addressAddressCountry').closest('form').querySelector('[type="submit"]').addEventListener('click', function(e) {

                                if (EAO.util.shouldBeChecked()) {
                                    e.preventDefault();

                                    // Resume click after ac is done.
                                    window.EnderecoIntegrator.submitResume = function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    }

                                    EAO.util.checkAddress().then().catch(function() {
                                        EAO.waitUntilReady().then( function() {
                                            if(e.target.dispatchEvent(
                                                new EAO.util.CustomEvent(
                                                    'click',
                                                    {
                                                        'bubbles': true,
                                                        'cancelable': true
                                                    }
                                                )
                                            )) {
                                                e.target.click();
                                            }
                                        }).catch();
                                    });
                                    return false;
                                }
                            })
                        });
                        $shippingAMSNewSet = true;
                    }
                } else {
                    $shippingAMSNewSet = false;
                }
            }, 100)
        })();
    </script>
{% endblock %}
