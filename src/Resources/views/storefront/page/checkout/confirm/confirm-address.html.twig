{% sw_extends '@Storefront/storefront/page/checkout/confirm/confirm-address.html.twig' %}

{% block page_checkout_confirm_address %}
    {% if page.endereco_config.pluginActive %}
        {% set checkAddressEnabled = page.endereco_config.enderecoCheckAddressEnabled %}
        {% set checkPayPalAddressEnabled = page.endereco_config.enderecoCheckPayPalExpressAddress %}
        {% set billingNeedsCorrection = checkAddressEnabled and billingAddress.extensions.enderecoAddress.needsCorrection() %}
        {% set shippingNeedsCorrection = checkAddressEnabled and (billingAddress.id is not same as shippingAddress.id) ? shippingAddress.extensions.enderecoAddress.needsCorrection() : false %}

        {% if not checkPayPalAddressEnabled and billingAddress.extensions.enderecoAddress.isPayPalAddress %}
            {% set billingNeedsCorrection = false %}
        {% endif %}

        {% if not checkPayPalAddressEnabled and shippingAddress.extensions.enderecoAddress.isPayPalAddress %}
            {% set shippingNeedsCorrection = false %}
        {% endif %}

        {% set options = {
            billingNeedsCorrection: billingNeedsCorrection,
            shippingNeedsCorrection: shippingNeedsCorrection
        } %}

        {% if billingNeedsCorrection %}
            <form method="post"
                  action="{{ path('frontend.endereco.account.address.edit.save') }}"
                  class="d-none"
                  data-end-target-link="billingEdit"
                  data-form-ajax-submit="true">
                {{ sw_csrf('frontend.endereco.account.address.edit.save') }}


                {% sw_include '@EnderecoShopware6Client/storefront/component/address/hidden-address-form.html.twig' with {
                    'prefix': 'address',
                    'data': billingAddress,
                } %}

                <button type="submit">
                </button>
            </form>
        {% endif %}
        {{ parent() }}

    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}


{% block  page_checkout_confirm_address_billing_actions_link %}
    <a href="{{ path('frontend.account.address.edit.page', {'addressId': billingAddress.id}) }}"
       title="{{ "account.overviewChangeBilling"|trans|striptags }}"
       class="btn btn-light"
       data-end-address-edit-id="billingEdit"
       data-address-editor="true"
       data-address-editor-options='{{ addressEditorOptions|json_encode }}'>
        {{ "account.overviewChangeBilling"|trans|sw_sanitize }}
    </a>
{% endblock %}
